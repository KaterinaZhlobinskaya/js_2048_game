function t(t){return t.map(t=>[...t])}class e{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.state=t(e),this.initialState=t(e),this.score=0,this.status="idle"}randomNum(){let t=Object.entries(this.state.flat()).filter(([,t])=>0===t).map(([t])=>t);if(0===t.length)return;let e=t[Math.floor(Math.random()*t.length)],s=Math.floor(e/this.state.length),i=e%this.state.length;this.state[s][i]=Math.random()>=.9?4:2}mergeArr(t,e=!1){if(e){for(let e=t.length-1;e>0;e--)if(0!==t[e])for(let s=e-1;s>=0;s--){if(t[e]===t[s]){t[e]*=2,t[s]=0,this.score+=t[e];break}if(t[e]!==t[s]&&t[s])break}for(let e=t.length-1;e>0;e--)if(0===t[e]){for(let s=e-1;s>=0;s--)if(0!==t[s]){t[e]=t[s],t[s]=0;break}}}else{for(let e=0;e<t.length-1;e++)if(0!==t[e])for(let s=e+1;s<t.length;s++){if(t[e]===t[s]){t[e]*=2,t[s]=0,this.score+=t[e];break}if(t[e]!==t[s]&&t[s])break}for(let e=0;e<t.length;e++)if(0===t[e]){for(let s=e+1;s<t.length;s++)if(0!==t[s]){t[e]=t[s],t[s]=0;break}}}}mergeColumn(t,e=!1){let s=this.state.map(e=>e[t]);this.mergeArr(s,e),this.state.forEach((e,i)=>{e[t]=s[i]})}mergeRow(t,e=!1){let s=this.state[t];this.mergeArr(s,e)}getStrState(){return this.getState().flat().join()}moveIfPlaying(t){if("playing"===this.status){let e=this.getStrState();for(let e=0;e<this.state.length;e++)t(e);e!==this.getStrState()&&this.randomNum()}}moveLeft(){this.moveIfPlaying(t=>this.mergeRow(t))}moveRight(){this.moveIfPlaying(t=>this.mergeRow(t,!0))}moveUp(){this.moveIfPlaying(t=>this.mergeColumn(t))}moveDown(){this.moveIfPlaying(t=>this.mergeColumn(t,!0))}getScore(){return this.score}getState(){return this.state}getStatus(){if("idle"===this.status)return"idle";if(-1!==this.state.flat().findIndex(t=>2048===t))return"win";let s=new e(t(this.state));return(s.status="playing",s.moveDown(),s.moveLeft(),s.moveRight(),s.moveUp(),0===s.getScore()&&-1===this.state.flat().findIndex(t=>0===t))?"lose":this.status}start(){this.randomNum(),this.randomNum(),this.status="playing"}restart(){this.state=t(this.initialState),this.score=0,this.status="idle"}}const s=new e,i=document.querySelector(".game-score"),r=document.querySelector(".message-start"),a=document.querySelector(".message-lose"),o=document.querySelector(".message-win"),l=document.querySelector("button.button"),n=document.querySelectorAll(".field-row"),h=()=>{let t=s.getState();for(let e=0;e<t.length;e++)for(let s=0;s<t.length;s++){let i=t[e][s],r=n.item(e).children.item(s);r.className="field-cell",r.textContent="",0!==i&&(r.classList.add(`field-cell--${i}`),r.textContent=i)}},m=t=>{i.innerText=t,i.value=t};document.addEventListener("keydown",({key:t})=>{"idle"!==s.getStatus()&&("lose"===s.getStatus()&&a.classList.remove("hidden"),"win"===s.getStatus()&&o.classList.remove("hidden"),"playing"===s.getStatus()&&("ArrowLeft"===t&&s.moveLeft(),"ArrowRight"===t&&s.moveRight(),"ArrowUp"===t&&s.moveUp(),"ArrowDown"===t&&s.moveDown(),h()),m(s.getScore()))});const g=()=>{s.start(),h(),r.classList.add("hidden")},d=()=>{s.restart(),h(),m(s.getScore()),a.classList.add("hidden"),o.classList.add("hidden")};l.addEventListener("click",({target:t})=>{d(),g(),t.classList.remove("start"),t.classList.add("restart"),t.innerText="Restart",t.style.fontSize="17px"});
//# sourceMappingURL=index.42c01dac.js.map
